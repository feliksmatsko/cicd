name: Release Candidate Maker

on:
  release:
    types: [ published ]

jobs:
  release_candidate:
    name: 'Create release candidate branch'
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          ref: master

      - name: Get release options
        id: release_options
        uses: ./.github/actions/get-release-options

      - name: Setup git config
        run: |
          git config user.email github-actions@github.com
          git config user.name github-actions

      - name: Apply version bump
        run: |
          VERSION=${{ steps.release_options.outputs.version }}
          git checkout master
          npm version $VERSION -m "Bump to version %s" --no-git-tag-version
          git push

      - name: Create release branch
        run: |
          TAG_NAME=${{ steps.release_options.outputs.tag_name }}
          git checkout -b release/$TAG_NAME master
          git push -u origin release/$TAG_NAME

      - name: Print summary
        run: |
          TAG_NAME=${{ steps.release_options.outputs.tag_name }}
          RELEASE_URL=${{ steps.release_options.outputs.url }}
          echo "## ðŸŽ‰ Release [$TAG_NAME]($RELEASE_URL) successfully created" >> $GITHUB_STEP_SUMMARY